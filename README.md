# EmailNotixion - 实时IMAP邮件推送插件

一个用于AstrBot的实时邮件推送插件，支持多账号IMAP邮件监控和推送。

## 功能特性

- ✅ 支持多邮箱账号同时监控
- ✅ 实时邮件推送通知
- ✅ 可配置推送间隔
- ✅ 自动重连和错误恢复
- ✅ 支持群组和私聊推送

## 安全注意事项

⚠️ **重要安全提醒**：

### 密码安全
- **本插件将邮箱密码以明文形式存储在配置文件中**，这存在安全风险
- 请务必使用**应用专用密码**或**授权码**，切勿使用账号登录密码
- 定期更换授权码/应用专用密码
- 确保配置文件的访问权限受到适当保护
- 不要在公共场合输入邮箱密码
- 如果安全要求较高，建议通过环境变量等方式管理敏感信息

### 账号管理安全
- 及时清理不需要的账号配置
- 在不使用时及时关闭邮件推送功能
- 定期检查账号列表，确保没有未授权的配置

## 指令说明

### 基本指令：`/email` 或 `/mail`

| 用法 | 说明 |
|------|------|
| `/email` | 开/关切换邮件推送 |
| `/email on` / `/email off` | 显式开启/关闭推送 |
| `/email list` | 查看当前配置的账号列表 |
| `/email interval <秒>` | 设置推送间隔；不带参数查看当前值 |

### 账号管理

| 用法 | 说明 |
|------|------|
| `/email add imap.server.com,user@domain.com,password` | 添加邮箱账号 |
| `/email del user@domain.com` | 删除指定邮箱账号（需要完整邮箱地址，精确匹配） |

## 配置说明

### 添加邮箱账号

使用以下格式添加邮箱账号：
```
/email add IMAP服务器,邮箱地址,密码
```

示例：
```
/email add imap.gmail.com,myemail@gmail.com,app_password
/email add imap.qq.com,123456@qq.com,authorization_code
```

### 删除邮箱账号

⚠️ **重要：删除账号时必须提供完整的邮箱地址，支持精确匹配**

```
/email del user@domain.com
```

**注意事项：**
- 必须提供完整的邮箱地址（包括@域名部分）
- 删除操作使用精确匹配，只会删除完全匹配的邮箱账号
- 删除操作会立即生效，如果邮件推送服务正在运行，会自动重新加载配置
- 删除不存在的账号会提示错误

**示例：**
```
/email del myemail@gmail.com     # 只会删除这个确切的邮箱
/email del test@company.com      # 不会影响 test123@company.com
```

### 推送间隔设置

```
/email interval 5    # 设置为5秒检查一次
/email interval      # 查看当前间隔
```

- 最小间隔：0.5秒
- 默认间隔：3秒
- 建议间隔：3-10秒（避免频繁请求导致服务器限制）

## 使用流程

1. **添加邮箱账号**：
   ```
   /email add imap.server.com,user@domain.com,password
   ```

2. **开启邮件推送**：
   ```
   /email on
   ```

3. **（可选）调整推送间隔**：
   ```
   /email interval 5
   ```

4. **查看配置**：
   ```
   /email list
   ```

## 常见问题

### Q: 为什么收不到邮件推送？
A: 请检查：
- 邮箱账号配置是否正确
- IMAP服务是否已开启
- 网络连接是否正常
- 推送服务是否已开启（`/email on`）

### Q: 支持哪些邮箱服务？
A: 支持所有提供IMAP服务的邮箱，包括但不限于：
- Gmail（需要应用专用密码）
- QQ邮箱（需要授权码）
- 163/126邮箱（需要授权码）
- 企业邮箱等

### Q: 如何获取应用专用密码/授权码？
A: 不同邮箱服务提供商的设置方法不同：
- **Gmail**: 账户设置 → 安全性 → 应用专用密码
- **QQ邮箱**: 设置 → 账户 → POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务
- **163邮箱**: 设置 → POP3/SMTP/IMAP → 客户端授权密码

### Q: 为什么删除账号时必须提供完整邮箱地址？
A: 为了避免误删，插件使用精确匹配来删除账号。这样可以确保只删除指定的账号，不会因为邮箱地址相似而误删其他账号。

### Q: 配置文件中的密码安全吗？
A: **不安全**。本插件将密码以明文形式存储在配置文件中，存在安全风险。建议：
- 仅使用应用专用密码，不要使用主账号密码
- 确保配置文件访问权限受限
- 定期更换密码
- 如有高安全要求，请考虑其他解决方案

## 开发者说明

### 环境变量配置（用于独立运行 xmail.py）

如果需要独立测试 `xmail.py` 模块，请设置以下环境变量：

```bash
# Linux/Mac
export EMAIL_HOST=imap.gmail.com
export EMAIL_USER=your-email@gmail.com
export EMAIL_TOKEN=your-app-password

# Windows
set EMAIL_HOST=imap.gmail.com
set EMAIL_USER=your-email@gmail.com
set EMAIL_TOKEN=your-app-password
```

⚠️ **安全提醒**：绝对不要在代码中硬编码真实的邮箱凭据。

## 技术说明

- 使用异步设计，不会阻塞机器人主线程
- 基于IMAP UID机制检测新邮件，确保可靠性
- 自动处理连接断开和错误重连
- 支持邮件内容解析和编码处理

## 注意事项

⚠️ **安全提醒**：
- 请使用应用专用密码，不要使用账号登录密码
- 定期更换授权码/应用专用密码
- 不要在公共场合输入邮箱密码

⚠️ **使用建议**：
- 推送间隔不宜过短，避免被邮箱服务器限制
- 及时清理不需要的账号配置
- 在网络不稳定时可能会有延迟，属于正常现象
